---
sidebar_position: 2
title: API إدارة المهام
description: مرجع كامل لنقاط نهاية إدارة المهام
---

تسجل هذه الصفحة جميع نقاط نهاية API المتاحة لإدارة مهام TikMatrix.

## إنشاء مهمة

إنشاء مهام جديدة لجهاز واحد أو أكثر أو أسماء مستخدمين.

- **نقطة النهاية:** `POST /api/v1/task`
- **Content-Type:** `application/json`

### معاملات الطلب

يدعم API وضعين لإنشاء المهام:

**الوضع 1: وضع الجهاز** - استخدام `serials` لإنشاء مهام للأجهزة
**الوضع 2: وضع اسم المستخدم** - استخدام `usernames` لإنشاء مهام مباشرة لحسابات محددة

| المعامل | النوع | مطلوب | الوصف |
|------|------|------|------|
| serials | string[] | مطلوب شرطيًا | مصفوفة الأرقام التسلسلية للأجهزة (مطلوب إذا لم يتم توفير `usernames`) |
| usernames | string[] | مطلوب شرطيًا | مصفوفة أسماء المستخدمين (مطلوبة إذا لم يتم توفير `serials`). عند توفير هذه المعاملة، يتم إنشاء المهام مباشرة لهذه الحسابات. |
| script_name | string | نعم | اسم النص البرمجي المراد تنفيذه |
| script_config | object | نعم | معاملات تكوين النص البرمجي (راجع وثائق النص البرمجي المقابل) |
| enable_multi_account | boolean | لا | ما إذا كان يجب تمكين وضع الحسابات المتعددة (افتراضي: false). يعمل فقط في وضع الجهاز. |
| start_time | string | لا | وقت التنفيذ المجدول بتنسيق "HH:MM" |

### النصوص البرمجية المدعومة

| اسم النص البرمجي | الوصف | الوثائق |
|----------|------|------|
| post | نشر فيديو أو صورة على TikTok/Instagram | [تكوين نص النشر](./post-script.md) |

### مثال

```bash
curl -X POST http://localhost:50809/api/v1/task \
  -H "Content-Type: application/json" \
  -d '{
    "serials": ["device_serial_1"],
    "script_name": "post",
    "script_config": {
      "content_type": 0,
      "captions": "شاهد الفيديو الجديد الخاص بي! #trending #fyp",
      "material_list": ["C:/Videos/video1.mp4"],
      "upload_wait_time": 60
    }
  }'
```

للحصول على معاملات `script_config` التفصيلية والمزيد من الأمثلة، راجع [تكوين نص النشر](./post-script.md).

### الاستجابة

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "task_ids": [101, 102],
    "created_count": 2
  }
}
```

## إدراج المهام

الاستعلام عن المهام مع شروط تصفية اختيارية.

- **نقطة النهاية:** `GET /api/v1/task`

| المعامل | النوع | مطلوب | الوصف |
|------|------|------|------|
| status | integer | لا | تصفية حسب الحالة (0=pending, 1=running, 2=completed, 3=failed) |
| serial | string | لا | تصفية حسب الرقم التسلسلي للجهاز |
| script_name | string | لا | تصفية حسب اسم النص البرمجي |
| source | string | لا | تصفية حسب المصدر ("ui" أو "api") |
| page | integer | لا | رقم الصفحة (افتراضي: 1) |
| page_size | integer | لا | عدد العناصر في كل صفحة (افتراضي: 20، الحد الأقصى: 100) |

## الحصول على تفاصيل المهمة

الحصول على معلومات تفصيلية عن مهمة محددة.

- **نقطة النهاية:** `GET /api/v1/task/{task_id}`

## حذف مهمة

حذف مهمة. إذا كانت المهمة قيد التشغيل، سيحاول إيقافها أولاً.

- **نقطة النهاية:** `DELETE /api/v1/task/{task_id}`

## حذف مهام دفعية

حذف مهام متعددة دفعة واحدة، وسيتم إيقاف المهام قيد التشغيل أولاً.

- **نقطة النهاية:** `DELETE /api/v1/task/batch`
- **نص الطلب:** `{ "task_ids": [1, 2, 3] }`

## إيقاف مهمة

إيقاف مهمة قيد التشغيل.

- **نقطة النهاية:** `POST /api/v1/task/{task_id}/stop`

## إعادة محاولة مهمة فاشلة

إعادة محاولة مهمة فاشلة واحدة.

- **نقطة النهاية:** `POST /api/v1/task/{task_id}/retry`

## إعادة محاولة جميع المهام الفاشلة

إعادة محاولة جميع المهام الفاشلة دفعة واحدة.

- **نقطة النهاية:** `POST /api/v1/task/retry-all`

## الحصول على إحصائيات المهام

الحصول على بيانات إحصائية إجمالية للمهام.

- **نقطة النهاية:** `GET /api/v1/task/stats`
- **الاستجابة:** تُرجع عداد total و pending و running و completed و failed.

## التحقق من ترخيص API

التحقق مما إذا كان ترخيصك يدعم الوصول إلى API.

- **نقطة النهاية:** `GET /api/v1/license/check`
- **ملاحظة:** ستُرجع خطة Starter رمز الخطأ 40301؛ خطط Pro/Team/Business يمكنها الوصول إلى API.
